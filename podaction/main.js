var jsonData=[];jsonData[0]={columns:[["x",15424128e5,15424992e5,15425856e5,1542672e6,15427584e5,15428448e5,15429312e5,15430176e5,1543104e6,15431904e5,15432768e5,15433632e5,15434496e5,1543536e6,15436224e5,15437088e5,15437952e5,15438816e5,1543968e6,15440544e5,15441408e5,15442272e5,15443136e5,15444e8,15444864e5,15445728e5,15446592e5,15447456e5,1544832e6,15449184e5,15450048e5,15450912e5,15451776e5,1545264e6,15453504e5,15454368e5,15455232e5,15456096e5,1545696e6,15457824e5,15458688e5,15459552e5,15460416e5,1546128e6,15462144e5,15463008e5,15463872e5,15464736e5,154656e7,15466464e5,15467328e5,15468192e5,15469056e5,1546992e6,15470784e5,15471648e5,15472512e5,15473376e5,1547424e6,15475104e5,15475968e5,15476832e5,15477696e5,1547856e6,15479424e5,15480288e5,15481152e5,15482016e5,1548288e6,15483744e5,15484608e5,15485472e5,15486336e5,154872e7,15488064e5,15488928e5,15489792e5,15490656e5,1549152e6,15492384e5,15493248e5,15494112e5,15494976e5,1549584e6,15496704e5,15497568e5,15498432e5,15499296e5,1550016e6,15501024e5,15501888e5,15502752e5,15503616e5,1550448e6,15505344e5,15506208e5,15507072e5,15507936e5,155088e7,15509664e5,15510528e5,15511392e5,15512256e5,1551312e6,15513984e5,15514848e5,15515712e5,15516576e5,1551744e6,15518304e5,15519168e5,15520032e5],["y0",37,20,32,39,32,35,19,65,36,62,113,69,120,60,51,49,71,122,149,69,57,21,33,55,92,62,47,50,56,116,63,60,55,65,76,33,45,64,54,81,180,123,106,37,60,70,46,68,46,51,33,57,75,70,95,70,50,68,63,66,53,38,52,109,121,53,36,71,96,55,58,29,31,55,52,44,126,191,73,87,255,278,219,170,129,125,126,84,65,53,154,57,71,64,75,72,39,47,52,73,89,156,86,105,88,45,33,56,142,124,114,64],["y1",22,12,30,40,33,23,18,41,45,69,57,61,70,47,31,34,40,55,27,57,48,32,40,49,54,49,34,51,51,51,66,51,94,60,64,28,44,96,49,73,30,88,63,42,56,67,52,67,35,61,40,55,63,61,105,59,51,76,63,57,47,56,51,98,103,62,54,104,48,41,41,37,30,28,26,37,65,86,70,81,54,74,70,50,74,79,85,62,36,46,68,43,66,50,28,66,39,23,63,74,83,66,40,60,29,36,27,54,89,50,73,52]],types:{y0:"line",y1:"line",x:"x"},names:{y0:"#0",y1:"#1"},colors:{y0:"#3DC23F",y1:"#F34C44"}};var canvasSmall=document.getElementById("chartAllTime"),canvasBig=document.getElementById("chartSelectedTime"),canvasBigParent=canvasBig.parentNode,smallCanvasHeight=100,bigCanvasHeight=canvasBig.offsetHeight,allCanvasWidth=window.innerWidth,data=[],bigChartData={},selectedTimeEl=document.getElementById("stw"),hiddenTimeEl=document.getElementById("stg");function Chart(e,t,a){this.width=e,this.height=t,this.data=a,this.dataObj={}}Chart.prototype.dataAnalysis=function(e,t){var a={};a.chartall=t,a.multiply=e||1,a.length=this.data.columns[0].length,a.x=(this.width/a.length).toFixed(4);var l=Math.max.apply(null,this.data.columns[a.chartall[0]+1].slice(1).concat(this.data.columns[a.chartall[1]].slice(1)));a.y=(l/this.height).toFixed(4),this.dataObj=a},Chart.prototype.buildChart=function(e,t,a){var l=e.getContext("2d"),n=t;this.dataAnalysis([1,1],n),this.canvas=e,this.canvas.width=allCanvasWidth,this.canvas.height=this.height;for(var i=t[0];i<+t[1];i++){l.beginPath(),l.lineWidth=a||1,l.lineJoin="round",l.strokeStyle=this.data.colors["y"+i],l.moveTo(1,this.height);for(var s=1;s<=this.data.columns[0].length;s++)l.lineTo(s*this.dataObj.x,e.height-Math.floor(this.data.columns[i+1][s]/this.dataObj.y));l.stroke()}};var changeBigChard=function(e,t,a,l){var n=a[0]||selectedTimeEl.getBoundingClientRect().left,i=(a[1]||selectedTimeEl.getBoundingClientRect().right)-n,s=Math.round(i/e.dataObj.x),o=Math.round(n/e.dataObj.x)<1?1:Math.round(n/e.dataObj.x),h=Math.max.apply(null,e.data.columns[e.dataObj.chartall[0]+1].slice(o,o+s).concat(e.data.columns[e.dataObj.chartall[1]].slice(o,o+s))),c=(e.width/s).toFixed(5),d=(bigCanvasHeight/h).toFixed(5);bigChartData.xPoints=s,bigChartData.namberStart=o,bigChartData.xStep=c,bigChartData.yStep=d,t.width=allCanvasWidth,t.height=bigCanvasHeight;var r=t.getContext("2d");bigChartData.context=r;for(var g=e.dataObj.chartall[0];g<e.dataObj.chartall[1];g++){r.beginPath(),r.lineWidth=l||2,r.lineJoin="round",r.strokeStyle=e.data.colors["y"+g],r.shadowColor="rgba(10, 10, 10, .7)",r.shadowBlur=.5,r.shadowOffsetX=1.5,r.moveTo(1,t.height+3-(d*e.data.columns[g+1][o]).toFixed(4));for(var m=1;m<=s+1;m++)r.lineTo(m*c,t.height+3-(d*e.data.columns[g+1][m+o]).toFixed(4));r.stroke()}var C=(t.height/6).toFixed(4),u=Math.round(h/6);r.beginPath(),r.strokeStyle="rgba(100, 100, 100, .9)",r.lineWidth=.3;for(g=1;g<7;g++)r.moveTo(25,C*g),r.lineTo(t.width,C*g),r.font="14px sans-serif",r.fillStyle="rgba(50,50,50, .9)",r.shadowColor="rgba(10, 10, 10, .9)",r.shadowBlur=1,r.shadowOffsetX=0,r.fillText(u*g,1,t.height-C*g);r.stroke(),r.beginPath(),r.fillStyle="black",r.font="12px serif";for(g=0;g<s;g++)r.fillText("| "+new Date(e.data.columns[0][o+7*g]).toLocaleDateString(),g*c*7,t.height-1)};function move(e){function a(){selectedTimeEl.onmousemove=null,selectedTimeEl.onmouseup=null,selectedTimeEl.removeEventListener("mousemove",n),selectedTimeEl.removeEventListener("mousemove",l)}var t=e.pageX-selectedTimeEl.getBoundingClientRect().left;if(t<=8&&-8<=t){var l=function(e){data[0]=selectedTimeEl.getBoundingClientRect().left,data[1]=selectedTimeEl.getBoundingClientRect().right;var t=selectedTimeEl.getBoundingClientRect().left-e.pageX;selectedTimeEl.style.left=e.pageX+"px",selectedTimeEl.style.width=selectedTimeEl.offsetWidth+t+"px",setTimeout(function(){changeBigChard(smallChart_0,canvasBig,data,3)},300),selectedTimeEl.onmouseup=a,selectedTimeEl.onmouseleave=a};selectedTimeEl.addEventListener("mousemove",l)}else{var n=function(e){data[0]=selectedTimeEl.getBoundingClientRect().left,data[1]=selectedTimeEl.getBoundingClientRect().right,selectedTimeEl.style.left=data[0]<0?"1px":e.pageX-t+"px",data[0]<=0&&selectedTimeEl.removeEventListener("mousemove",n),data[1]>allCanvasWidth+3&&(selectedTimeEl.style.left=allCanvasWidth-selectedTimeEl.offsetWidth-3+"px",selectedTimeEl.removeEventListener("mousemove",n)),setTimeout(function(){changeBigChard(smallChart_0,canvasBig,data,3)},200),selectedTimeEl.onmouseup=a,selectedTimeEl.onmouseleave=a};selectedTimeEl.addEventListener("mousemove",n)}}var move2=function(e){selectedTimeEl.getBoundingClientRect().left<1&&(selectedTimeEl.style.left="1px"),selectedTimeEl.getBoundingClientRect().right>allCanvasWidth&&(selectedTimeEl.style.left=allCanvasWidth-parseInt(getComputedStyle(selectedTimeEl).width)+"px");var l=parseInt(getComputedStyle(selectedTimeEl).left),n=parseInt(getComputedStyle(selectedTimeEl).width),i=[],t=e.changedTouches[0],s=parseInt(t.clientX),o=s-selectedTimeEl.getBoundingClientRect().left,h=function(a){if(o<10&&-10<o){!function(){i[0]=selectedTimeEl.getBoundingClientRect().left,i[1]=selectedTimeEl.getBoundingClientRect().right;var e=a.changedTouches[0],t=parseInt(e.clientX)-s;selectedTimeEl.style.left=l+t+"px",selectedTimeEl.style.width=n-t+"px",selectedTimeEl.ontouchend=function(){selectedTimeEl.removeEventListener("touchmove",h)},changeBigChard(smallChart_0,canvasBig,i,3)}()}else{i[0]=selectedTimeEl.getBoundingClientRect().left,i[1]=selectedTimeEl.getBoundingClientRect().right;var e=a.changedTouches[0],t=parseInt(e.clientX)-s;selectedTimeEl.style.left=l+t+"px",selectedTimeEl.ontouchend=function(){selectedTimeEl.getBoundingClientRect().left<1&&(selectedTimeEl.style.left="1px"),selectedTimeEl.getBoundingClientRect().right>allCanvasWidth&&(selectedTimeEl.style.left=allCanvasWidth-parseInt(getComputedStyle(selectedTimeEl).width)+"px"),selectedTimeEl.removeEventListener("touchmove",h)},changeBigChard(smallChart_0,canvasBig,i,3)}};selectedTimeEl.addEventListener("touchmove",h)};function showData(e){changeBigChard(smallChart_0,canvasBig,data,3);var t=e.pageX,a=Math.round(t/bigChartData.xStep),l=bigChartData.namberStart+a,n=new Date(smallChart_0.data.columns[0][l]).toDateString(),i=smallChart_0.data.columns[1][l],s=smallChart_0.data.columns[2][l];bigChartData.context.beginPath(),bigChartData.context.moveTo(a*bigChartData.xStep,bigCanvasHeight),bigChartData.context.lineTo(a*bigChartData.xStep,5),bigChartData.context.moveTo(a*bigChartData.xStep+10,bigCanvasHeight-20),bigChartData.context.fillStyle="white",bigChartData.context.shadowColor="rgba(10, 10, 10, .7)",bigChartData.context.shadowBlur=5,bigChartData.context.shadowOffsetX=0,bigChartData.context.shadowOffsetY=-1,t<Math.round(allCanvasWidth/2)?(bigChartData.context.fillRect(a*bigChartData.xStep+1,bigCanvasHeight-58,130,60),bigChartData.context.stroke(),bigChartData.context.beginPath(),bigChartData.context.fillStyle="gray",bigChartData.context.shadowColor="white",bigChartData.context.shadowBlur=0,bigChartData.context.font="14px sans-serif",bigChartData.context.fillText("| "+n,a*bigChartData.xStep+10,bigCanvasHeight-40),bigChartData.context.fillStyle="green",bigChartData.context.fillText("| Joined: "+i,a*bigChartData.xStep+10,bigCanvasHeight-20),bigChartData.context.fillStyle="red",bigChartData.context.fillText("| Left: "+s,a*bigChartData.xStep+10,bigCanvasHeight-5)):(bigChartData.context.fillRect(a*bigChartData.xStep-131,bigCanvasHeight-58,130,60),bigChartData.context.stroke(),bigChartData.context.beginPath(),bigChartData.context.fillStyle="gray",bigChartData.context.shadowColor="white",bigChartData.context.shadowBlur=0,bigChartData.context.font="14px sans-serif",bigChartData.context.fillText("| "+n,a*bigChartData.xStep+10-130,bigCanvasHeight-40),bigChartData.context.fillStyle="green",bigChartData.context.fillText("| Joined: "+i,a*bigChartData.xStep+10-130,bigCanvasHeight-20),bigChartData.context.fillStyle="red",bigChartData.context.fillText("| Left: "+s,a*bigChartData.xStep+10-130,bigCanvasHeight-5)),bigChartData.context.stroke()}selectedTimeEl.ondragstart=function(){return!1},selectedTimeEl.onclick=function(){return!1},selectedTimeEl.addEventListener("mousedown",move),selectedTimeEl.addEventListener("touchstart",function(e){selectedTimeEl.onmousedown=null;var t=e.changedTouches[0].clientX;t>this.getBoundingClientRect().left-5&&t<this.getBoundingClientRect().right&&move2(e)}),canvasBigParent.addEventListener("click",showData);var btnNight=document.getElementById("night"),main=document.getElementById("main");btnNight.onclick=function(){main.classList.toggle("night")};var btn_checked1=document.getElementById("checked1"),btn_checked2=document.getElementById("checked2"),btn_next=document.getElementById("btn_next"),btn_one=document.getElementById("y0"),btn_two=document.getElementById("y1");btn_one.onclick=function(){btn_checked1.classList.toggle("checked-off"),smallChart_0.dataObj.chartall[0]=0==smallChart_0.dataObj.chartall[0]?1:0,changeBigChard(smallChart_0,canvasBig,!1,3)},btn_two.onclick=function(){btn_checked2.classList.toggle("checked-off"),smallChart_0.dataObj.chartall[1]=2==smallChart_0.dataObj.chartall[1]?1:2,changeBigChard(smallChart_0,canvasBig,!1,3)};var smallChart_0=new Chart(allCanvasWidth,smallCanvasHeight,jsonData[0]);smallChart_0.buildChart(canvasSmall,[0,2],1),changeBigChard(smallChart_0,canvasBig,!1,3);var counter=0,send=(counter=0,!0);btn_next.onclick=function(){if(send){var e=new XMLHttpRequest;e.open("GET","/chart_data.json"),e.onreadystatechange=function(e){if(4==this.readyState)if(200==this.status){4<=++counter&&(counter=0);var t=JSON.parse(this.responseText);jsonData[1]=t[1],jsonData[2]=t[2],jsonData[3]=t[3],jsonData[4]=t[4],(smallChart_0=new Chart(allCanvasWidth,smallCanvasHeight,jsonData[counter])).buildChart(canvasSmall,[0,2],1),changeBigChard(smallChart_0,canvasBig,!1,3),send=!1}else console.log("error request!"),counter=0},e.send(null)}else{4<++counter&&(counter=0),smallChart_0=new Chart(allCanvasWidth,smallCanvasHeight,jsonData[counter]);var t=4<=counter?4:2;smallChart_0.buildChart(canvasSmall,[0,t],1),changeBigChard(smallChart_0,canvasBig,!1,3)}},window.onresize=function(){var e;e||(e=setTimeout(function(){e=null,allCanvasWidth=window.innerWidth,bigCanvasHeight=canvasBig.offsetHeight,(smallChart_0=new Chart(allCanvasWidth,smallCanvasHeight,jsonData[counter])).buildChart(canvasSmall,[0,2],1),changeBigChard(smallChart_0,canvasBig,!1,3)},100))};